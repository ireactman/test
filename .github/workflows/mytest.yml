name: mytest

on:
  workflow_dispatch: # Allows manual trigger of the workf

env:
  GH_TOKEN: ${{ secrets.PAT_TOKEN }}

jobs:
  check_dependabot_bump:
    runs-on: ubuntu-latest

    steps:
      # - name: Dependabot metadata
      #   id: dependabot-metadata
      #   uses: dependabot/fetch-metadata@v2

      # PR_kwDONPafFs6CsSNM
      
        # Checkout the repository
      - name: Checkout Code
        uses: actions/checkout@v4

      - name: Find Dependabot PR for msw
        id: find_pr
        run: |
          PR_URL=$(gh pr list --search "dependabot update msw" --json url --jq ".[0].url")
          echo "PR_URL=${PR_URL}" >> $GITHUB_ENV

      # If no Dependabot PR exists, exit the workflow
      - name: Exit if no Dependabot bump for msw
        if: ${{ env.PR_URL == '' }}
        run: echo "No Dependabot PR for MSW found. Exiting workflow."

      # Pull the changes and create a new PR
      - name: Create new PR for msw bump
        if: ${{ env.PR_URL != '' }}
        run: |
          gh pr checkout "${PR_URL}"
          git checkout -b new-msw-bump
          npx msw init public/ --save
          git status
          git add .
          git push origin new-msw-bump
          gh pr create --title "chore: bump msw to latest version" \
                       --body "This PR is based on the Dependabot bump for the MSW library." \
                       --base main --head new-msw-bump